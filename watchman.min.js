!function(e,n){var t="undefined"!=typeof define,r="undefined"!=typeof exports;t?define(e,[],n):r?exports=n(require,exports,module):this[e]=n()}("watchman",function(e){function n(e,r){if(!(arguments.length<2)){"_watching"in n||(n._watching=[]);var a=t(e,r);return n._watching.push(a),n}if(0===arguments.length)return n.run();switch(typeof e){case"object":for(var i in e)n(i,e[i]);break;case"string":n.run({url:e})}}function t(e,n){var t=r(e);return t.handler=n,t}function r(e){if(e instanceof RegExp)return{keys:[],regexp:e};e instanceof Array&&(e="("+e.join("|")+")");var n={keys:[],regexp:null};return n.regexp=new RegExp("^"+(i(e)?"/":"")+e.replace(/([\/\(]+):/g,"(?:").replace(/\(\?:(\w+)((\(.*?\))*)/g,function(e,t,r){if(n.keys.push(t),r)var a=r.replace(/\(|\)/g,"");else var a="/?([^/]+)";return"(?:"+a+"?)"}).replace("))",")").replace(/\*/g,"(.*)")+"((#.+)?)$","i"),n}function a(e,n){for(var t=n.regexp.exec(e).slice(1),r=n.keys,a={},i=0;i<r.length;i++)a[r[i]]=t[i];return a}function i(e){return/^#/.test(e)}function o(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t]);return n}var e=e||window;return n.use=function(){"_watchman_middlewares"in n||(n._watchman_middlewares=[]);var e=o(arguments);return Array.prototype.push.apply(n._watchman_middlewares,e),n},n.run=function(t){function r(e){var t=n._watchman_middlewares[e];t?t(c,function(){r(++f)}):u(c)}t=t||{};var i=t.url||e.location.pathname+e.location.hash,o=n._watching;n.emit("statechange",i);for(var s=0;s<o.length;s++)if(o[s].regexp.exec(i)){var h=a(i,o[s]),c={params:h,path:i},u=o[s].handler;if("_watchman_middlewares"in n){var f=0;r(f)}else u(c)}if(!n.running){if("onhashchange"in e)switch("function"){case typeof e.addEventListener:e.addHashChange=function(n,t){e.addEventListener("hashchange",n,t)},e.removeHashChange=function(n){e.removeEventListener("hashchange",n)};break;case typeof e.attachEvent:e.addHashChange=function(n){e.attachEvent("onhashchange",n)},e.removeHashChange=function(n){e.detachEvent("onhashchange",n)};break;default:e.addHashChange=function(n){e.onhashchange=n},e.removeHashChange=function(n){e.onhashchange==n&&(e.onhashchange=null)}}else{var l=n.hashChangeFuncs=[];n.oldHref=e.location.href,e.addHashChange=function(e,t){"function"==typeof e&&n.hashChangeFuncs[t?"unshift":"push"](e)},e.removeHashChange=function(e){for(var n=l.length-1;n>=0;--n)l[n]===e&&l.splice(n,1)},setInterval(function(){var t=e.location.href;if(n.oldHref!==t){n.oldHref=t;for(var r=0;r<l.length;r++)l[r].call(e,{type:"hashchange",newURL:t,oldURL:n.oldHref})}},100)}e.addHashChange(function(){n.run()}),n.emit("watching"),n.running=!0}return n},n.on=function(e,t){if("_events"in n||(n._events={}),"function"!=typeof t)throw TypeError("listener must be a function");return this._events[e]||(this._events[e]=[]),this._events[e].push(t),n},n.once=function(e,t){function r(){n.removeEventListener(e,r),t.apply(n,arguments)}if("function"!=typeof t)throw TypeError("listener must be a function");return n.on(e,r),n},n.emit=function(e){"_events"in n||(n._events={});var t=n._events[e];if(t)for(var r=0;r<t.length;r++){var a=o(arguments).slice(1);t[r].apply(n,a)}return n},n.removeEventListener=function(e,t){if("_events"in n||(n._events={}),"function"!=typeof t)throw TypeError("listener must be a function");var r=n._events[e];if(r){var a=r.indexOf(t);r.splice(a,1)}return n},n.removeAllListeners=function(e){return"_events"in n||(n._events={}),delete n._events[e],n},n});